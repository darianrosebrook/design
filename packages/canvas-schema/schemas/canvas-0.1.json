{
  "$id": "https://paths.design.dev/schemas/canvas-0.1.json",
  "title": "CanvasDocument",
  "type": "object",
  "required": ["schemaVersion", "id", "name", "artboards"],
  "properties": {
    "schemaVersion": { "const": "0.1.0" },
    "id": { "type": "string", "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$" },
    "name": { "type": "string" },
    "meta": { "type": "object", "additionalProperties": true },
    "artboards": {
      "type": "array",
      "items": { "$ref": "#/$defs/Artboard" },
      "minItems": 1
    }
  },
  "$defs": {
    "Artboard": {
      "type": "object",
      "required": ["id", "name", "frame", "children"],
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "frame": { "$ref": "#/$defs/Rect" },
        "background": { "$ref": "#/$defs/Fill", "default": {"type":"solid","color":"tokens.color.background"} },
        "children": { "type": "array", "items": { "$ref": "#/$defs/Node" } }
      }
    },
    "Node": {
      "oneOf": [
        { "$ref": "#/$defs/FrameNode" },
        { "$ref": "#/$defs/TextNode" },
        { "$ref": "#/$defs/ComponentInstanceNode" }
      ]
    },
    "BaseNode": {
      "type": "object",
      "required": ["id", "type", "name", "visible", "frame", "style"],
      "properties": {
        "id": { "type": "string" },
        "type": { "type": "string" },
        "name": { "type": "string" },
        "visible": { "type": "boolean", "default": true },
        "frame": { "$ref": "#/$defs/Rect" },
        "style": { "$ref": "#/$defs/Style" },
        "data": { "type": "object", "additionalProperties": true },
        "bind": { "$ref": "#/$defs/Binding" },
        "semanticKey": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9]*(\\.[a-z0-9]+|\\[[0-9]+\\])*$",
          "description": "Semantic identifier for stable node reference (e.g., 'hero.title', 'nav.items[0]')"
        }
      }
    },
    "FrameNode": {
      "allOf": [
        { "$ref": "#/$defs/BaseNode" },
        {
          "properties": {
            "type": { "const": "frame" },
            "layout": { "$ref": "#/$defs/Layout" },
            "children": { "type": "array", "items": { "$ref": "#/$defs/Node" } }
          }
        }
      ]
    },
    "TextNode": {
      "allOf": [
        { "$ref": "#/$defs/BaseNode" },
        {
          "properties": {
            "type": { "const": "text" },
            "text": { "type": "string" },
            "textStyle": { "$ref": "#/$defs/TextStyle" }
          },
          "required": ["text"]
        }
      ]
    },
    "ComponentInstanceNode": {
      "allOf": [
        { "$ref": "#/$defs/BaseNode" },
        {
          "properties": {
            "type": { "const": "component" },
            "componentKey": { "type": "string" },
            "props": { "type": "object", "additionalProperties": true }
          },
          "required": ["componentKey"]
        }
      ]
    },
    "Rect": {
      "type": "object",
      "required": ["x", "y", "width", "height"],
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" },
        "width": { "type": "number", "minimum": 0 },
        "height": { "type": "number", "minimum": 0 }
      }
    },
    "Style": {
      "type": "object",
      "properties": {
        "fills": { "type": "array", "items": { "$ref": "#/$defs/Fill" } },
        "strokes": { "type": "array", "items": { "$ref": "#/$defs/Stroke" } },
        "radius": { "type": "number" },
        "opacity": { "type": "number", "minimum": 0, "maximum": 1 },
        "shadow": { "$ref": "#/$defs/Shadow" }
      },
      "additionalProperties": false
    },
    "Fill": {
      "type": "object",
      "properties": {
        "type": { "enum": ["solid", "linearGradient", "radialGradient"] },
        "color": { "type": "string" },
        "stops": { "type": "array", "items": { "$ref": "#/$defs/ColorStop" } }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "Stroke": {
      "type": "object",
      "properties": {
        "color": { "type": "string" },
        "thickness": { "type": "number", "minimum": 0 }
      },
      "required": ["color", "thickness"],
      "additionalProperties": false
    },
    "Shadow": {
      "type": "object",
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" },
        "blur": { "type": "number" },
        "spread": { "type": "number" },
        "color": { "type": "string" }
      },
      "additionalProperties": false
    },
    "ColorStop": {
      "type": "object",
      "properties": {
        "offset": { "type": "number", "minimum": 0, "maximum": 1 },
        "color": { "type": "string" }
      },
      "required": ["offset", "color"]
    },
    "TextStyle": {
      "type": "object",
      "properties": {
        "family": { "type": "string" },
        "size": { "type": "number" },
        "lineHeight": { "type": "number" },
        "weight": { "type": "string" },
        "letterSpacing": { "type": "number" },
        "color": { "type": "string" }
      },
      "additionalProperties": false
    },
    "Layout": {
      "type": "object",
      "properties": {
        "mode": { "enum": ["absolute", "flex", "grid"], "default": "absolute" },
        "direction": { "enum": ["row", "column"] },
        "gap": { "type": "number" },
        "padding": { "type": "number" }
      },
      "additionalProperties": false
    },
    "Binding": {
      "type": "object",
      "properties": {
        "token": { "type": "string" },
        "prop": { "type": "string" },
        "cssVar": { "type": "string" }
      },
      "additionalProperties": false
    }
  }
}